#!/bin/bash

set -eufo pipefail


{{ if and (index . "macos") (index .macos "defaults") -}}
{{- range $domain, $entry := .macos.defaults -}}
{{- range $key, $setting := $entry.setting -}}
defaults write {{ $domain }} {{ $key }} {{ if (index $setting "type") }}-{{ $setting.type }}{{ else }}-string{{ end }} {{ if kindIs "map" $setting.value -}}
{{- range $k, $v := $setting.value }}{{ $k }} {{ $v | quote }} {{ end }}
{{ else if kindIs "slice" $setting.value }}
{{- range $i, $v := .value }}{{ $v | quote }} {{ end }}
{{ else }}
{{- $setting.value | quote }}
{{ end }}
{{- end }}
{{- end }}
{{- else }}
# No macos defaults found.
{{- end }}



# macOS Dock Configurations
# =========================
#
# References
# ----------
# - https://github.com/kcrawford/dockutil
# - https://github.dev/twpayne/dotfiles/blob/master/home/.chezmoiscripts/linux/run_onchange_before_install-packages.sh.tmpl

trap 'killall Dock' EXIT

declare -a remove_labels=(
	Launchpad
	Safari
	Messages
	Mail
	Maps
	Photos
	FaceTime
	Contacts
	Reminders
	Notes
	Freeform
	TV
	Music
	Keynote
	Numbers
	Pages
	"App Store"
)

for label in "${remove_labels[@]}"; do
	dockutil --no-restart --remove "${label}" || true
done
